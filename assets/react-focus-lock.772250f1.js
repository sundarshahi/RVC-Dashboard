import{r as a}from"./react.7ded48a1.js";import{_ as T,d as le}from"./@babel.d4c7f82f.js";import{F as ve,a as me,m as _,f as U,b as Fe,g as pe}from"./focus-lock.9fb50670.js";import{c as S,a as he}from"./use-sidecar.aa4a0fa4.js";import{u as be}from"./use-callback-ref.38831812.js";import{w as xe}from"./react-clientside-effect.e38ba01c.js";var I={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},$=S({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),H=S(),ge=S(),Ee=he({async:!0}),we=[],B=a.exports.forwardRef(function(e,t){var n,o=a.exports.useState(),s=o[0],i=o[1],l=a.exports.useRef(),v=a.exports.useRef(!1),u=a.exports.useRef(null),x=e.children,c=e.disabled,d=e.noFocusGuards,g=e.persistentFocus,f=e.crossFrame,m=e.autoFocus;e.allowTextSelection;var y=e.group,Q=e.className,V=e.whiteList,W=e.shards,X=W===void 0?we:W,G=e.as,Y=G===void 0?"div":G,O=e.lockProps,Z=O===void 0?{}:O,ee=e.sideCar,w=e.returnFocus,P=e.onActivation,k=e.onDeactivation,re=a.exports.useState({}),te=re[0],ae=a.exports.useCallback(function(){u.current=u.current||document&&document.activeElement,l.current&&P&&P(l.current),v.current=!0},[P]),ne=a.exports.useCallback(function(){v.current=!1,k&&k(l.current)},[k]),oe=a.exports.useCallback(function(F){var C=u.current;if(Boolean(w)&&C&&C.focus){var D=typeof w=="object"?w:void 0;u.current=null,F?Promise.resolve().then(function(){return C.focus(D)}):C.focus(D)}},[w]),ue=a.exports.useCallback(function(F){v.current&&$.useMedium(F)},[]),se=H.useMedium,ie=a.exports.useCallback(function(F){l.current!==F&&(l.current=F,i(F))},[]),ce=T((n={},n[ve]=c&&"disabled",n[me]=y,n),Z),A=d!==!0,de=A&&d!=="tail",fe=be([t,ie]);return a.exports.createElement(a.exports.Fragment,null,A&&[a.exports.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:c?-1:0,style:I}),a.exports.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:c?-1:1,style:I})],!c&&a.exports.createElement(ee,{id:te,sideCar:Ee,observed:s,disabled:c,persistentFocus:g,crossFrame:f,autoFocus:m,whiteList:V,shards:X,onActivation:ae,onDeactivation:ne,returnFocus:oe}),a.exports.createElement(Y,T({ref:fe},ce,{className:Q,onBlur:se,onFocus:ue}),x),de&&a.exports.createElement("div",{"data-focus-guard":!0,tabIndex:c?-1:0,style:I}))});B.propTypes={};B.defaultProps={children:void 0,disabled:!1,returnFocus:!1,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};var j=B;function N(r){var e=window,t=e.setImmediate;typeof t!="undefined"?t(r):setTimeout(r,1)}var Ce=function(){return document&&document.activeElement===document.body},Le=function(){return Ce()||Fe()},h=null,p=null,b=null,E=!1,ye=function(){return!0},Pe=function(e){return(h.whiteList||ye)(e)},ke=function(e,t){b={observerNode:e,portaledElement:t}},Ie=function(e){return b&&b.portaledElement===e};function M(r,e,t,n){var o=null,s=r;do{var i=n[s];if(i.guard)i.node.dataset.focusAutoGuard&&(o=i);else if(i.lockItem){if(s!==r)return;o=null}else break}while((s+=t)!==e);o&&(o.node.tabIndex=0)}var Te=function(e){return e&&"current"in e?e.current:e},Se=function(e){return e?Boolean(E):E==="meanwhile"},L=function(){var e=!1;if(h){var t=h,n=t.observed,o=t.persistentFocus,s=t.autoFocus,i=t.shards,l=t.crossFrame,v=n||b&&b.portaledElement,u=document&&document.activeElement;if(v){var x=[v].concat(i.map(Te).filter(Boolean));if((!u||Pe(u))&&(o||Se(l)||!Le()||!p&&s)&&(v&&!(U(x)||Ie(u))&&(document&&!p&&u&&!s?(u.blur&&u.blur(),document.body.focus()):(e=_(x,p),b={})),E=!1,p=document&&document.activeElement),document){var c=document&&document.activeElement,d=pe(x),g=d.map(function(f){var m=f.node;return m}).indexOf(c);g>-1&&(d.filter(function(f){var m=f.guard,y=f.node;return m&&y.dataset.focusAutoGuard}).forEach(function(f){var m=f.node;return m.removeAttribute("tabIndex")}),M(g,d.length,1,d),M(g,-1,-1,d))}}}return e},q=function(e){L()&&e&&(e.stopPropagation(),e.preventDefault())},R=function(){return N(L)},Be=function(e){var t=e.target,n=e.currentTarget;n.contains(t)||ke(n,t)},Re=function(){return null},z=function(){E="just",setTimeout(function(){E="meanwhile"},0)},We=function(){document.addEventListener("focusin",q,!0),document.addEventListener("focusout",R),window.addEventListener("blur",z)},Ge=function(){document.removeEventListener("focusin",q,!0),document.removeEventListener("focusout",R),window.removeEventListener("blur",z)};function Oe(r){return r.filter(function(e){var t=e.disabled;return!t})}function Ae(r){var e=r.slice(-1)[0];e&&!h&&We();var t=h,n=t&&e&&e.id===t.id;h=e,t&&!n&&(t.onDeactivation(),r.filter(function(o){var s=o.id;return s===t.id}).length||t.returnFocus(!e)),e?(p=null,(!n||t.observed!==e.observed)&&e.onActivation(),L(),N(L)):(Ge(),p=null)}$.assignSyncMedium(Be);H.assignMedium(R);ge.assignMedium(function(r){return r({moveFocusInside:_,focusInside:U})});var De=xe(Oe,Ae)(Re),J=a.exports.forwardRef(function(e,t){return a.exports.createElement(j,T({sideCar:De,ref:t},e))}),K=j.propTypes||{};K.sideCar;le(K,["sideCar"]);J.propTypes={};var Ne=J;export{Ne as F};
